<?xml version="1.0" encoding="UTF-8"?>

<jbpm-configuration xmlns="http://jbpm.org/xsd/cfg">

    <import resource="jbpm.jpdl.cfg.xml" />
    <import resource="jbpm.identity.cfg.xml" />
    
    <!-- NU este necesar in momentul de fata (este folosit la job-uri si timere). -->
    <!-- <import resource="jbpm.jobexecutor.cfg.xml" /> -->
    
    <import resource="jbpm.businesscalendar.cfg.xml" />

    <process-engine-context>

        <repository-service />
        <repository-cache />
        <execution-service />
        <history-service />
        <management-service />
        <task-service />
        <identity-service />
        
    	<object class="org.jbpm.pvm.internal.id.DatabaseDbidGenerator">
      		<field name="commandService"><ref object="txRequiredCommandService" /></field>
    	</object>

    	<object class="org.jbpm.pvm.internal.id.DatabaseIdComposer" init="eager" />
        
     	<types resource="jbpm.variable.types.xml" />

   	<!--	<command-service name="newTxRequiredCommandService">
	      	<retry-interceptor />
	      	<environment-interceptor policy="requiresNew" />
	      	<spring-transaction-interceptor current="true" />
    	</command-service>
    
         Here we needed to change the transaction interceptor -->
        <command-service name="txRequiredCommandService">
            <retry-interceptor />
      		<environment-interceptor current="true"/>
      		<spring-transaction-interceptor current="true"/>
        </command-service>
        
        <deployer-manager>
            <jpdl-deployer />
        </deployer-manager>

        <!-- Added spring as read-context -->
        <script-manager default-expression-language="juel"
                    default-script-language="juel"
                    read-contexts="execution, environment, process-engine, spring"
                    write-context="">
            <script-language name="juel" factory="org.jbpm.pvm.internal.script.JuelScriptEngineFactory" />
        </script-manager>

        <authentication />

		<!-- NU este necesar in momentul de fata (este folosit la job-uri si timere). -->
        <!-- <job-executor command-service="commandService" auto-start="false" /> -->

        <id-generator />
        <types resource="jbpm.variable.types.xml" />

        <business-calendar>
            <monday    hours="9:00-12:00 and 12:30-17:00"/>
            <tuesday   hours="9:00-12:00 and 12:30-17:00"/>
            <wednesday hours="9:00-12:00 and 12:30-17:00"/>
            <thursday  hours="9:00-12:00 and 12:30-17:00"/>
            <friday    hours="9:00-12:00 and 12:30-17:00"/>
            <holiday period="01/07/2008 - 31/08/2008"/>
        </business-calendar>

        <mail-template name='task-notification'>
            <to users="${task.assignee}" />
            <subject>${task.name}</subject>
            <text><![CDATA[Hi ${task.assignee},
Task "${task.name}" has been assigned to you.
${task.description}

Sent by JBoss jBPM
]]>
            </text>
        </mail-template>
        <mail-template name='task-reminder'>
            <to users="${task.assignee}" />
            <subject>${task.name}</subject>
            <text><![CDATA[Hey ${task.assignee},
Do not forget about task "${task.name}".
${task.description}

Sent by JBoss jBPM
]]>
            </text>
        </mail-template>
    </process-engine-context>

    <transaction-context>
    	<transaction type="spring" />
        <repository-session />
        <db-session />
        <message-session />
        <timer-session />
        <history-sessions>
        	<object class="org.jbpm.pvm.internal.history.HistorySessionImpl" />
       	</history-sessions>
        <mail-session>
			<mail-server>
				<session-properties resource="jbpm.mail.properties" />
			</mail-server>
		</mail-session>
        <identity-session />
        <!-- Need to set explicitly that we don't want jbpm to create sessions -->
        <hibernate-session current="true" />
    </transaction-context>  
    
</jbpm-configuration>