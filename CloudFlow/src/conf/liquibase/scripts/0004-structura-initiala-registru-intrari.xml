<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd
        	http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

	<changeSet id="0004-creare-tabele" author="CloudSoft.User1">
		<sql endDelimiter=";">
			CREATE TABLE REGISTRU_INTRARI (
				ID BIGINT NOT NULL,
				NUMAR_INREGISTRARE TEXT NOT NULL,
				DATA_INREGISTRARE TIMESTAMP NOT NULL,
				NUME_EMITENT TEXT,
				DEPARTAMENT_EMITENT TEXT NOT NULL,
				NUMAR_DOCUMENT_EMITENT TEXT NOT NULL,
				DATA_DOCUMENT_EMITENT TIMESTAMP NOT NULL,
				TIP_DOCUMENT_ID BIGINT NOT NULL,
				TRIMIS_PE_MAIL BOOLEAN NOT NULL,
				CONTINUT TEXT NOT NULL,
				NUMAR_PAGINI NUMERIC NOT NULL,
				NUMAR_ANEXE NUMERIC NOT NULL,
				REPARTIZAT_CATRE_USER_ID BIGINT NOT NULL,
				NECESITA_RASPUNS BOOLEAN NOT NULL,
				TERMEN_RASPUNS TIMESTAMP,
				REGISTRU_IESIRI_ID BIGINT,
				OBSERVATII TEXT NOT NULL,
				RASPUNSURI_BANCI_CU_PROPUNERI TEXT NOT NULL,
				NR_ZILE_INTRARE_EMITENT NUMERIC NOT NULL,
				NR_ZILE_RASPUNS_INTRARE NUMERIC NOT NULL,
				NR_ZILE_RASPUNS_EMITENT NUMERIC NOT NULL,
				NR_ZILE_TERMEN_DATA_RASPUNS NUMERIC NOT NULL,
				ANULAT BOOLEAN,
				MOTIV_ANULARE TEXT,
								
				CONSTRAINT REGISTRU_INTRARI_PK PRIMARY KEY (ID)
			);
			
			CREATE TABLE REGISTRU_INTRARI_COMISIE_GL (
				ID BIGINT NOT NULL,
				REGISTRU_INTRARI_ID BIGINT NOT NULL,
				COMISII_GL_ID BIGINT NOT NULL,
				
				CONSTRAINT REGISTRU_INTRARI_COMISIE_GL_PK PRIMARY KEY (ID)
			);
			
			CREATE TABLE REGISTRU_INTRARI_PROIECT (
				ID BIGINT NOT NULL,
				REGISTRU_INTRARI_ID BIGINT NOT NULL,
				PROIECT_ID BIGINT NOT NULL,
				
				CONSTRAINT REGISTRU_INTRARI_PROIECT_PK PRIMARY KEY (ID)
			);
		</sql>
	</changeSet>
	
	<changeSet id="0004-adaugare-constrangeri" author="CloudSoft.User1">
		<sql endDelimiter=";">
			ALTER TABLE REGISTRU_INTRARI ADD CONSTRAINT REG_INTRARI_TIP_DOCUMENT_ID_FK FOREIGN KEY (TIP_DOCUMENT_ID) REFERENCES NOMENCLATOR_VALUES (ID);
			ALTER TABLE REGISTRU_INTRARI ADD CONSTRAINT REG_INTRARI_REPARTZT_USR_ID_FK FOREIGN KEY (REPARTIZAT_CATRE_USER_ID) REFERENCES EDOCUSER (ORG_ENTITY_ID);
			ALTER TABLE REGISTRU_INTRARI ADD CONSTRAINT REG_INTRARI_NR_INREGISTRARE_UQ UNIQUE (NUMAR_INREGISTRARE);
			
			ALTER TABLE REGISTRU_INTRARI_COMISIE_GL ADD CONSTRAINT REG_INT_COMGL_REG_INTRAR_ID_FK FOREIGN KEY (REGISTRU_INTRARI_ID) REFERENCES REGISTRU_INTRARI (ID);
			ALTER TABLE REGISTRU_INTRARI_COMISIE_GL ADD CONSTRAINT REG_INT_COMGL_COMISII_GL_ID_FK FOREIGN KEY (COMISII_GL_ID) REFERENCES NOMENCLATOR_VALUES (ID);
			
			ALTER TABLE REGISTRU_INTRARI_PROIECT ADD CONSTRAINT REG_INT_PROIECT_REG_INT_ID_FK FOREIGN KEY (REGISTRU_INTRARI_ID) REFERENCES REGISTRU_INTRARI (ID);
			ALTER TABLE REGISTRU_INTRARI_PROIECT ADD CONSTRAINT REG_INT_PROIECT_PROIECT_ID_FK FOREIGN KEY (PROIECT_ID) REFERENCES PROJECT (ID);
		</sql>
	</changeSet>
	
</databaseChangeLog>