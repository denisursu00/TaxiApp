<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd
        	http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

	<changeSet id="0005-creare-tabele" author="CloudSoft.User1">
		<sql endDelimiter=";">
			CREATE TABLE REGISTRU_IESIRI (
				ID BIGINT NOT NULL,
				NUMAR_INREGISTRARE TEXT NOT NULL,
				DATA_INREGISTRARE TIMESTAMP NOT NULL,
				TIP_DOCUMENT_ID BIGINT NOT NULL,
				NUMAR_PAGINI NUMERIC NOT NULL,
				NUMAR_ANEXE NUMERIC NOT NULL,
				INTOCMIT_DE_USER_ID BIGINT NOT NULL,
				MAIL BOOLEAN NOT NULL,
				CONTINUT TEXT NOT NULL,
				ASTEPTAM_RASPUNS BOOLEAN NOT NULL,
				TERMEN_RASPUNS TIMESTAMP,
				MOTIV_ANUMARE TEXT,
				ANULAT BOOLEAN,
				
				CONSTRAINT REGISTRU_IESIRI_PK PRIMARY KEY (ID)
			);
			
			CREATE TABLE REGISTRU_IESIRI_DESTINATAR (
				ID BIGINT NOT NULL,
				NUME TEXT NOT NULL,
				DEPARTAMENT TEXT NOT NULL,
				NUMAR_INREGISTRARE TEXT NOT NULL,
				DATA_INREGISTRARE TIMESTAMP NOT NULL,
				REGISTRU_INTRARI_ID BIGINT,
				OBSERVATII TEXT NOT NULL,
				COMISII_GL_ID BIGINT NOT NULL,
				REGISTRU_IESIRI_ID BIGINT NOT NULL,
				
				CONSTRAINT REGISTRU_IESIRI_DESTINATAR_PK PRIMARY KEY (ID)
			);
			
			CREATE TABLE REGISTRU_IESIRI_PROIECT (
				REGISTRU_IESIRI_ID BIGINT NOT NULL,
				PROIECT_ID BIGINT NOT NULL,
				
				CONSTRAINT REGISTRU_IESIRI_PROIECT_PK PRIMARY KEY (REGISTRU_IESIRI_ID, PROIECT_ID)
			);
		</sql>
	</changeSet>
	
	<changeSet id="0005-adaugare-constrangeri" author="CloudSoft.User1">
		<sql endDelimiter=";">
			ALTER TABLE REGISTRU_IESIRI ADD CONSTRAINT REGISTRU_IESIRI_NUMAR_INREG_UQ UNIQUE (NUMAR_INREGISTRARE);
			ALTER TABLE REGISTRU_IESIRI ADD CONSTRAINT REGISTRU_IESIRI_TIP_DOC_ID_FK FOREIGN KEY (TIP_DOCUMENT_ID) REFERENCES NOMENCLATOR_VALUES (ID);
			ALTER TABLE REGISTRU_IESIRI ADD CONSTRAINT REGISTRU_IESIRI_INTOCMT_USR_ID FOREIGN KEY (INTOCMIT_DE_USER_ID) REFERENCES EDOCUSER (ORG_ENTITY_ID);
			
			ALTER TABLE REGISTRU_IESIRI_DESTINATAR ADD CONSTRAINT REG_IESIRI_DEST_NUMAR_INREG_UQ UNIQUE (NUMAR_INREGISTRARE);
			ALTER TABLE REGISTRU_IESIRI_DESTINATAR ADD CONSTRAINT REG_IESIRI_DEST_COMIS_GL_ID_FK FOREIGN KEY (COMISII_GL_ID) REFERENCES NOMENCLATOR_VALUES (ID);
			ALTER TABLE REGISTRU_IESIRI_DESTINATAR ADD CONSTRAINT REG_IESIRI_DEST_REG_IESR_ID_FK FOREIGN KEY (REGISTRU_IESIRI_ID) REFERENCES REGISTRU_IESIRI (ID);
			
			ALTER TABLE REGISTRU_IESIRI_PROIECT ADD CONSTRAINT REG_IES_PROIECT_REG_IES_ID_FK FOREIGN KEY (REGISTRU_IESIRI_ID) REFERENCES REGISTRU_IESIRI (ID);
			ALTER TABLE REGISTRU_IESIRI_PROIECT ADD CONSTRAINT REG_IES_PROIECT_PROIECT_ID_FK FOREIGN KEY (PROIECT_ID) REFERENCES PROJECT (ID);
		</sql>
	</changeSet>
	
</databaseChangeLog>