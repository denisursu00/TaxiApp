<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
	xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd
        	http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

	<changeSet
		id="0033-update-metadata-collection-comisii_gl-readonly-si-autocomplete-with-metadata" author="CloudSoft.User1">
		<sql endDelimiter=";"><![CDATA[
			update metadatacollection 
			set restricted_on_edit_steps='adaugare_comentariu_atasament;asignare_initiere_task;completare_metadate_minuta;corectie_minuta;minuta_finalizata;verificare_minuta',
			md_name_for_auto_cmpl_wth_md='denumire_document_prezenta_comisie_gl', 
			type_of_auto_cmpl_wth_md='CUSTOM_CLASS',
			class_name_for_aut_cmpl_wth_md='ro.cloudSoft.cloudDoc.services.content.autocompleteMetadata.AutocompleteComisiiGLOfMinutaSedintaComisieGL'
			where documenttype_id=(select id from documenttype where name='Minuta sedinta Comisie GL') and name='comisii_gl';
		]]>
		</sql>
	</changeSet>

	<changeSet
		id="0033-update-metadata-nume_comisie_gl-from-collection-comisii_gl-ca-readonly" author="CloudSoft.User1">
		<sql endDelimiter=";"><![CDATA[
			update metadatadefinition set restrictedoneditstates='adaugare_comentariu_atasament;asignare_initiere_task;completare_metadate_minuta;corectie_minuta;minuta_finalizata;verificare_minuta'
			where collection_id=(select id from metadatacollection where documenttype_id=(select id from documenttype where name='Minuta sedinta Comisie GL') and name='comisii_gl') and name='nume_comisie_gl';
		]]>
		</sql>
	</changeSet>

	<changeSet
		id="0033-update-metadata-collection-participanti-ca-readonly-si-autocomplete-with-metadata" author="CloudSoft.User1">
		<sql endDelimiter=";"><![CDATA[
			update metadatacollection 
			set restricted_on_edit_steps='adaugare_comentariu_atasament;asignare_initiere_task;completare_metadate_minuta;corectie_minuta;minuta_finalizata;verificare_minuta',
			md_name_for_auto_cmpl_wth_md='denumire_document_prezenta_comisie_gl', 
			type_of_auto_cmpl_wth_md='CUSTOM_CLASS',
			class_name_for_aut_cmpl_wth_md='ro.cloudSoft.cloudDoc.services.content.autocompleteMetadata.AutocompleteParticipantiOfMinutaSedintaComisieGL'
			where documenttype_id=(select id from documenttype where name='Minuta sedinta Comisie GL') and name='participanti';
		]]>
		</sql>
	</changeSet>

	<changeSet
		id="0033-update-metadatele-colectiei-participanti-ca-readonly" author="CloudSoft.User1">
		<sql endDelimiter=";"><![CDATA[
			update metadatadefinition set restrictedoneditstates='adaugare_comentariu_atasament;asignare_initiere_task;completare_metadate_minuta;corectie_minuta;minuta_finalizata;verificare_minuta'
			where collection_id=(select id from metadatacollection where documenttype_id=(select id from documenttype where name='Minuta sedinta Comisie GL') and name='participanti') and name='numar';
			
			update metadatadefinition set restrictedoneditstates='adaugare_comentariu_atasament;asignare_initiere_task;completare_metadate_minuta;corectie_minuta;minuta_finalizata;verificare_minuta'
			where collection_id=(select id from metadatacollection where documenttype_id=(select id from documenttype where name='Minuta sedinta Comisie GL') and name='participanti') and name='participant';
			
			update metadatadefinition set restrictedoneditstates='adaugare_comentariu_atasament;asignare_initiere_task;completare_metadate_minuta;corectie_minuta;minuta_finalizata;verificare_minuta'
			where collection_id=(select id from metadatacollection where documenttype_id=(select id from documenttype where name='Minuta sedinta Comisie GL') and name='participanti') and name='institutie';
		]]>
		</sql>
	</changeSet>

	<changeSet
		id="0033-update-metadata-denumire_document_prezenta_comisie_gl-ca-multiple_documents-from-minuta_sedinta_comisie_gl" author="CloudSoft.User1">
		<sql endDelimiter=";"><![CDATA[
			update metadatadefinition set multiple_documents_selection=TRUE
			where documenttype_id=(select id from documenttype where name='Minuta sedinta Comisie GL') and name='denumire_document_prezenta_comisie_gl'; 
		]]>
		</sql>
	</changeSet>

	<changeSet
		id="0033-update-ordine-metadate-minuta_sedinta_comisie_gl" author="CloudSoft.User1">
		<sql endDelimiter=";"><![CDATA[
			update metadatadefinition set ordernumber=3
			where documenttype_id=(select id from documenttype where name='Minuta sedinta Comisie GL') and name='denumire_document_prezenta_comisie_gl'; 
			
			update metadatacollection set ordernumber=4
			where documenttype_id=(select id from documenttype where name='Minuta sedinta Comisie GL') and name='comisii_gl';
			
			update metadatadefinition set ordernumber=5
			where documenttype_id=(select id from documenttype where name='Minuta sedinta Comisie GL') and name='data_sedinta';
			
			update metadatadefinition set ordernumber=6
			where documenttype_id=(select id from documenttype where name='Minuta sedinta Comisie GL') and name='locatie';
			
			update metadatacollection set ordernumber=7
			where documenttype_id=(select id from documenttype where name='Minuta sedinta Comisie GL') and name='participanti';
			
			update metadatadefinition set ordernumber=8
			where documenttype_id=(select id from documenttype where name='Minuta sedinta Comisie GL') and name='ordine_de_zi';
			
			update metadatadefinition set ordernumber=9
			where documenttype_id=(select id from documenttype where name='Minuta sedinta Comisie GL') and name='discutii_decizii';
			
			update metadatacollection set ordernumber=10
			where documenttype_id=(select id from documenttype where name='Minuta sedinta Comisie GL') and name='actiuni_viitoare';
			
			update metadatadefinition set ordernumber=11
			where documenttype_id=(select id from documenttype where name='Minuta sedinta Comisie GL') and name='redactat';
			
			update metadatadefinition set ordernumber=12
			where documenttype_id=(select id from documenttype where name='Minuta sedinta Comisie GL') and name='data_redactare';
			
			update metadatadefinition set ordernumber=13
			where documenttype_id=(select id from documenttype where name='Minuta sedinta Comisie GL') and name='user_validator';
			
			update metadatadefinition set ordernumber=14
			where documenttype_id=(select id from documenttype where name='Minuta sedinta Comisie GL') and name='corectie_necesara';
			
			update metadatacollection set ordernumber=15
			where documenttype_id=(select id from documenttype where name='Minuta sedinta Comisie GL') and name='comentarii_user_validator';
			
			update metadatadefinition set ordernumber=16
			where documenttype_id=(select id from documenttype where name='Minuta sedinta Comisie GL') and name='comentariu_initiator_minuta';
		]]>
		</sql>
	</changeSet>

	<changeSet
		id="0033-update-metadata-participant-of-participanti-value-labels-from-minuta_sedinta_comsie_gl" author="CloudSoft.User3">

		<sql endDelimiter=";"><![CDATA[
			update listmetadataitem
			set label='Invitat/Invitati'
			where list_id=( 
				select id 
				from metadatadefinition 
				where collection_id=(
					select id 
					from metadataCollection 
					where name='participanti'
						and documenttype_id=(select id
											from documenttype
											where name='Minuta sedinta Comisie GL')
					) and name='participant'
				) and value='invitat'; 
		
			update listmetadataitem
			set label='Membru Afiliat/Membri Afiliati'
			where list_id=( 
				select id 
				from metadatadefinition 
				where collection_id=(
					select id 
					from metadataCollection 
					where name='participanti'
						and documenttype_id=(select id
											from documenttype
											where name='Minuta sedinta Comisie GL')
					) and name='participant'
				) and value='membru_afiliat'; 
		]]>
		</sql>
	</changeSet>

</databaseChangeLog>