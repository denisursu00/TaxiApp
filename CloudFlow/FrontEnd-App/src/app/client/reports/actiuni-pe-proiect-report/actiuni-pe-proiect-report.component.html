<app-loading *ngIf="loading"></app-loading>
<p-panel [toggleable]="true">
    <p-header>
         {{'LABELS.REPORT_ACTIUNI_PE_PROIECT' | translate}}
    </p-header>
    <form [formGroup]="formGroup">		
		<div class="ui-grid ui-grid-responsive ui-grid-pad ui-fluid">
			<div class="ui-grid-row">
				<div class="ui-grid-col-3">
					{{'LABELS.REPORT_ACTIUNI_PE_PROIECT_FILTER_DATA_INCEPUT' | translate}}:
				</div>
				<div class="ui-grid-col-9">
					<p-calendar formControlName="dataInceput"
							showIcon="true" 
							[dateFormat]="dateFormat"
							monthNavigator="true" 
							yearNavigator="true"
							[yearRange]="yearRange"
							showButtonBar="true"
							appendTo="body" 
							[dataType]="'date'">
					</p-calendar>
				</div>
			</div>
			<div class="ui-grid-row">
				<div class="ui-grid-col-3">
					{{'LABELS.REPORT_ACTIUNI_PE_PROIECT_FILTER_DATA_SFARSIT' | translate}}:
				</div>
				<div class="ui-grid-col-9">
					<p-calendar formControlName="dataSfarsit"
							showIcon="true" 
							[dateFormat]="dateFormat"
							monthNavigator="true" 
							yearNavigator="true"
							[yearRange]="yearRange"
							showButtonBar="true"
							appendTo="body" 
							[dataType]="'date'">
					</p-calendar>
				</div>
            </div>
            <div class="ui-grid-row">
				<div class="ui-grid-col-3">
					{{'LABELS.REPORT_ACTIUNI_PE_PROIECT_FILTER_PROIECT' | translate}}:
				</div>
				<div class="ui-grid-col-9">
					<p-dropdown 
                        [options]="proiecteSelectItems"
                        [placeholder]="'LABELS.ALL' | translate"
                        [style]="{'width':'100%'}"
                        [showClear]="true"
                        appendTo="body"
						filter="true"
                        formControlName="proiect"
						(onChange)="onProiectSelectionChanged($event)">>
                    </p-dropdown>
				</div>
			</div>

            <div class="ui-grid-row">
                <div class="ui-grid-col-3">{{"LABELS.PROJECT_SUBACTIVITY" | translate}}: </div>
                <div class="ui-grid-col-9">
					<p-multiSelect 
						[filter]="true"
						[options]="subproiecteSelectItems"
						[defaultLabel]="'LABELS.SELECT' | translate"
						[showToggleAll]="true"
						formControlName="subproiecte"
						[style]="{'width':'100%'}"
						appendTo="body">
                    </p-multiSelect>
                </div>
            </div>
		</div>
	</form>
	<p-footer>
		<p-button [label]="'LABELS.REPORT_VIEW' | translate" (onClick)="onView()"></p-button>
	</p-footer>
</p-panel>

<p-table *ngIf="reportVisible"
		#actiuniPeProiectTaskTable
		[value]="report.actiuniPeProiectTask"  
		[columns]="columnsActiuniPeProiectTask"
		[responsive]="true"
		[resizableColumns]="true"
		[loading]="loading"
		[style]="{'margin-top':'5px'}"
		[scrollable]="true" 
		[scrollHeight]="scrollHeight"
		(onSort)="onSortActiuniPeProiectTask()">

	<ng-template pTemplate="caption">
		<div>
			{{'LABELS.REPORT_ACTIUNI_PE_PROIECT_HEADER_ACTIUNI_PE_PROIECT' | translate}}		
		</div>
		<div class="ui-helper-clearfix">
			<p-button [label]="'LABELS.EXPORT_CSV' | translate" (onClick)="onExportCsvActiuniPeProiectTask()" style="float:left"></p-button>
		</div>
	</ng-template>
		
	<ng-template pTemplate="colgroup">
		<colgroup>
			<col style="width: 35%">
			<col style="width: 20%">
			<col style="width: 25%">
			<col style="width: 10%">
			<col style="width: 10%">
		</colgroup>
	</ng-template>
	
	<ng-template pTemplate="header">
			<tr>
				<th pResizableColumn>{{"LABELS.REPORT_ACTIUNI_PE_PROIECT_NUME_PROIECT_ACTIUNI" | translate}}</th>
				<th pResizableColumn>{{"LABELS.REPORT_ACTIUNI_PE_PROIECT_NUME_SUBPROIECT_ACTIUNI" | translate}}</th>
				<th pResizableColumn>{{"LABELS.REPORT_ACTIUNI_PE_PROIECT_TIP_ACTIUNE" | translate}}</th>
				<th pResizableColumn>{{"LABELS.REPORT_ACTIUNI_PE_PROIECT_ACTIUNI" | translate}}</th>
				<th pResizableColumn>{{"LABELS.REPORT_ACTIUNI_PE_PROIECT_DATA_INCEPUT_TASK" | translate}}</th>
				<th pResizableColumn>{{"LABELS.REPORT_ACTIUNI_PE_PROIECT_STATUS" | translate}}</th>
			</tr>
	</ng-template>
	<ng-template pTemplate="body" let-row let-rowIndex="rowIndex">

		<tr class="ui-widget-header" *ngIf="rowGroupMetadataActiuniPeProiectTaskSubproiectSequenceList[rowIndex] === 1 && rowIndex != 0">
			<td></td>
			<td colspan="5">
				<span [ngStyle]="{'font-weight':'bold'}">{{"LABELS.REPORT_ACTIUNI_PE_PROIECT_TOTAL" | translate }}: {{ rowGroupMetadataActiuniPeProiectTaskSubproiectSequenceList[rowIndex - 1] }}</span>
			</td>
		</tr>
		
		<tr class="ui-widget-header" *ngIf="rowGroupMetadataActiuniPeProiectTaskProiectSequenceList[rowIndex] === 1 && rowIndex != 0">
			<td colspan="6">
				<span [ngStyle]="{'font-weight':'bold','font-size':'1.1em'}">{{"LABELS.REPORT_ACTIUNI_PE_PROIECT_TOTAL" | translate }}: {{ rowGroupMetadataActiuniPeProiectTaskProiectSequenceList[rowIndex - 1] }}</span>
			</td>
		</tr>

		<tr class="ui-widget-header" *ngIf="report.actiuniPeProiectTask[rowIndex]?.numeProiect !== report.actiuniPeProiectTask[rowIndex - 1]?.numeProiect">
			<td colspan="6">
				<span [ngStyle]="{'font-weight':'bold','font-size':'1.2em'}">{{"LABELS.REPORT_PARTICIPARI_LA_EVENIMENTE_PROIECT" | translate }}: {{row.numeProiect}}</span>
			</td>
		</tr>

		<tr class="ui-widget-header" *ngIf="report.actiuniPeProiectTask[rowIndex]?.numeSubproiect !== report.actiuniPeProiectTask[rowIndex - 1]?.numeSubproiect
											|| rowGroupMetadataActiuniPeProiectTaskProiectSequenceList[rowIndex] === 1">
			<td></td>
			<td colspan="5">
				<span [ngStyle]="{'font-weight':'bold'}">{{"LABELS.REPORT_ACTIUNI_PE_PROIECT_NUME_SUBPROIECT_ACTIUNI" | translate }}: {{row.numeSubproiect}}</span>
			</td>
		</tr>

		<tr [pSelectableRow]="row">	
			<td>{{row.numeProiect}}</td>
			<td>{{row.numeSubproiect}}</td>
			<td>{{row.tipActiune}}</td>					
			<td>{{row.actiuni}}</td>					
			<td>{{row.dataInceputTask | appDateFormater}}</td>				
			<td>{{ "LABELS.TASK_" + row.status | translate}}</td>		
		</tr>
		
		<tr class="ui-widget-header" *ngIf="rowIndex === report.actiuniPeProiectTask.length - 1">
			<td></td>
			<td colspan="5">
				<span [ngStyle]="{'font-weight':'bold'}">{{"LABELS.REPORT_ACTIUNI_PE_PROIECT_TOTAL" | translate }}: {{ rowGroupMetadataActiuniPeProiectTaskSubproiectSequenceList[rowIndex] }}</span>
			</td>
		</tr>
		
		<tr class="ui-widget-header" *ngIf="rowIndex === report.actiuniPeProiectTask.length - 1">
			<td colspan="6">
				<span [ngStyle]="{'font-weight':'bold','font-size':'1.1em'}">{{"LABELS.REPORT_ACTIUNI_PE_PROIECT_TOTAL" | translate }}: {{ rowGroupMetadataActiuniPeProiectTaskProiectSequenceList[rowIndex] }}</span>
			</td>
		</tr>
	</ng-template>

	<ng-template pTemplate="emptymessage" let-columns>
        <tr>
            <td [attr.colspan]="6">
                {{"LABELS.NO_RECORDS_FOUND" | translate}}
            </td>
        </tr>
    </ng-template>
</p-table>

<br>

<p-table *ngIf="reportVisible"
		#actiuniPeProiectRegistruIntrariIesiriTable
		[value]="report.actiuniPeProiectRegistruIntrariIesiri"  
		[columns]="columnsActiuniPeProiectRegistruIntrariIesiri"
		[responsive]="true"
		[resizableColumns]="true"
		[loading]="loading"
		[style]="{'margin-top':'5px'}"
		[scrollable]="true" 
		[scrollHeight]="scrollHeight"
		(onSort)="onSortActiuniPeProiectRegistruIntrariIesiri()">

	<ng-template pTemplate="caption">
		<div>
			{{'LABELS.REPORT_ACTIUNI_PE_PROIECT_HEADER_DOCUMENTE_PE_PROIECT_REGISTRU_INTRARI_IESIRI' | translate}}		
		</div>
		<div class="ui-helper-clearfix">
			<p-button [label]="'LABELS.EXPORT_CSV' | translate" (onClick)="onExportCsvActiuniPeProiectRegistruIntrariIesiri()" style="float:left"></p-button>
		</div>
	</ng-template>

	<ng-template pTemplate="colgroup">
		<colgroup>
			<col style="width: 35%">
			<col style="width: 20%">
			<col style="width: 25%">
			<col style="width: 10%">
			<col style="width: 10%">
		</colgroup>
	</ng-template>

	<ng-template pTemplate="header">
			<tr>
				<th pResizableColumn>{{"LABELS.REPORT_ACTIUNI_PE_PROIECT_NUME_PROIECT_DOCUMENTE" | translate}}</th>
				<th pResizableColumn>{{"LABELS.REPORT_ACTIUNI_PE_PROIECT_NUME_SUBPROIECT_ACTIUNI" | translate}}</th>
				<th pResizableColumn>{{"LABELS.REPORT_ACTIUNI_PE_PROIECT_TIP_DOCUMENT" | translate}}</th>
				<th pResizableColumn>{{"LABELS.REPORT_ACTIUNI_PE_PROIECT_DOCUMENT" | translate}}</th>
				<th pResizableColumn>{{"LABELS.REPORT_ACTIUNI_PE_PROIECT_DATA_INREGISTRARE" | translate}}</th>
				<th pResizableColumn>{{"LABELS.REPORT_ACTIUNI_PE_PROIECT_NUMAR_DE_INREGISTRARE" | translate}}</th>
			</tr>
	</ng-template>
	<ng-template pTemplate="body" let-row let-rowIndex="rowIndex">

		<tr class="ui-widget-header" *ngIf="rowGroupMetadataActiuniPeProiectRegistruIntrariIesiriSubproiectSequenceList[rowIndex] === 1 && rowIndex != 0">
			<td></td>
			<td colspan="5">
				<span [ngStyle]="{'font-weight':'bold'}">{{"LABELS.REPORT_ACTIUNI_PE_PROIECT_TOTAL" | translate }}: {{ rowGroupMetadataActiuniPeProiectRegistruIntrariIesiriSubproiectSequenceList[rowIndex - 1] }}</span>
			</td>
		</tr>
		
		<tr class="ui-widget-header" *ngIf="rowGroupMetadataActiuniPeProiectRegistruIntrariIesiriProiectSequenceList[rowIndex] === 1 && rowIndex != 0">
			<td colspan="6">
				<span [ngStyle]="{'font-weight':'bold','font-size':'1.1em'}">{{"LABELS.REPORT_ACTIUNI_PE_PROIECT_TOTAL" | translate }}: {{ rowGroupMetadataActiuniPeProiectRegistruIntrariIesiriProiectSequenceList[rowIndex - 1] }}</span>
			</td>
		</tr>

		<tr class="ui-widget-header" *ngIf="report.actiuniPeProiectRegistruIntrariIesiri[rowIndex]?.numeProiect !== report.actiuniPeProiectRegistruIntrariIesiri[rowIndex - 1]?.numeProiect">
			<td colspan="6">
				<span [ngStyle]="{'font-weight':'bold','font-size':'1.2em'}">{{"LABELS.REPORT_PARTICIPARI_LA_EVENIMENTE_PROIECT" | translate }}: {{row.numeProiect}}</span>
			</td>
		</tr>

		<tr class="ui-widget-header" *ngIf="report.actiuniPeProiectRegistruIntrariIesiri[rowIndex]?.numeSubproiect !== report.actiuniPeProiectRegistruIntrariIesiri[rowIndex - 1]?.numeSubproiect
											|| rowGroupMetadataActiuniPeProiectRegistruIntrariIesiriProiectSequenceList[rowIndex] === 1">
			<td></td>
			<td colspan="5">
				<span [ngStyle]="{'font-weight':'bold'}">{{"LABELS.REPORT_ACTIUNI_PE_PROIECT_NUME_SUBPROIECT_ACTIUNI" | translate }}: {{row.numeSubproiect}}</span>
			</td>
		</tr>

		<tr [pSelectableRow]="row">	
			<td>{{row.numeProiect}}</td>
			<td>{{row.numeSubproiect}}</td>
			<td>{{row.tipDocument}}</td>							
			<td>{{row.document}}</td>					
			<td>{{row.dataInregistrareForDisplay}}</td>				
			<td>{{row.numarDeInregistrare}}</td>		
		</tr>
		
		<tr class="ui-widget-header" *ngIf="rowIndex === report.actiuniPeProiectRegistruIntrariIesiri.length - 1">
			<td></td>
			<td colspan="5">
				<span [ngStyle]="{'font-weight':'bold'}">{{"LABELS.REPORT_ACTIUNI_PE_PROIECT_TOTAL" | translate }}: {{ rowGroupMetadataActiuniPeProiectRegistruIntrariIesiriSubproiectSequenceList[rowIndex] }}</span>
			</td>
		</tr>
		
		<tr class="ui-widget-header" *ngIf="rowIndex === report.actiuniPeProiectRegistruIntrariIesiri.length - 1">
			<td colspan="6">
				<span [ngStyle]="{'font-weight':'bold','font-size':'1.1em'}">{{"LABELS.REPORT_ACTIUNI_PE_PROIECT_TOTAL" | translate }}: {{ rowGroupMetadataActiuniPeProiectRegistruIntrariIesiriProiectSequenceList[rowIndex] }}</span>
			</td>
		</tr>
	</ng-template>

	<ng-template pTemplate="emptymessage" let-columns>
        <tr>
            <td [attr.colspan]="6">
                {{"LABELS.NO_RECORDS_FOUND" | translate}}
            </td>
        </tr>
    </ng-template>
</p-table>

<br>

<p-table *ngIf="reportVisible"
		#actiuniPeProiectNotaCDTable
		[value]="report.actiuniPeProiectNotaCD"  
		[columns]="columnsActiuniPeProiectNotaCD"
		[responsive]="true"
		[resizableColumns]="true"
		[loading]="loading"
		[style]="{'margin-top':'5px'}"
		[scrollable]="true" 
		[scrollHeight]="scrollHeight"
		(onSort)="onSortActiuniPeProiectNotaCD()">

	<ng-template pTemplate="caption">
		<div>
			{{'LABELS.REPORT_ACTIUNI_PE_PROIECT_HEADER_DOCUMENTE_PE_PROIECT_NOTE_CD' | translate}}		
		</div>
		<div class="ui-helper-clearfix">
			<p-button [label]="'LABELS.EXPORT_CSV' | translate" (onClick)="onExportCsvActiuniPeProiectNotaCD()" style="float:left"></p-button>
		</div>
	</ng-template>

	
	<ng-template pTemplate="colgroup">
		<colgroup>
			<col style="width: 15%">
			<col style="width: 10%">
			<col style="width: 65%">
			<col style="width: 10%">
		</colgroup>
	</ng-template>
	

	<ng-template pTemplate="header" let-columns>
			<tr>
				<th *ngFor="let col of columns" pResizableColumn>
                	{{col.header}}
            	</th>
			</tr>
	</ng-template>

	<ng-template pTemplate="body" let-row let-rowIndex="rowIndex" let-columns="columns">
			<tr [pSelectableRow]="row">	
                <td *ngFor="let col of columns">{{row[col.field]}}</td>	
			</tr>
			<tr class="ui-widget-header" *ngIf="rowGroupMetadataActiuniPeProiectNotaCD[row.tipNota].index === rowIndex">
				<td style="text-align: right;"><span style="font-weight:bold">{{"LABELS.REPORT_ACTIUNI_PE_PROIECT_TOTAL" | translate}}</span></td>
				<td colspan="3">
					<span style="font-weight:bold">{{rowGroupMetadataActiuniPeProiectNotaCD[row.tipNota].size}}</span>
				</td>
			</tr>
	</ng-template>
	<ng-template pTemplate="footer" *ngIf="report.actiuniPeProiectNotaCD.length > 0">
        <tr>
            <td style="text-align: right;"><span style="font-weight:bold">{{"LABELS.REPORT_ACTIUNI_PE_PROIECT_TOTAL_GENERAL" | translate}}</span></td>
			<td colspan="3">
				<span style="font-weight:bold">{{report.actiuniPeProiectNotaCD.length}}</span>
			</td>	
        </tr>
    </ng-template>	
	<ng-template pTemplate="emptymessage" let-columns>
        <tr>
            <td [attr.colspan]="4">
                {{"LABELS.NO_RECORDS_FOUND" | translate}}
            </td>
        </tr>
    </ng-template>
</p-table>