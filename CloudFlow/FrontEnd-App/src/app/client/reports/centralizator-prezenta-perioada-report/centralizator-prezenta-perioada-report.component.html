<app-loading *ngIf="loading"></app-loading>
<p-panel [toggleable]="true">
    <p-header>
         {{'LABELS.RAPORT_CENTRALIZATOR_PREZENTA_PERIOADA' | translate}}
    </p-header>
    <form [formGroup]="formGroup">		
		<div class="ui-grid ui-grid-responsive ui-grid-pad ui-fluid">
			<div class="ui-grid-row">
				<div class="ui-grid-col-3">
					{{'LABELS.RAPORT_CENTRALIZATOR_PREZENTA_PERIOADA_FILTER_DE_LA_DATA' | translate}}*:
				</div>
				<div class="ui-grid-col-9">
					<p-calendar formControlName="dataSedintaDeLa"
							showIcon="true" 
							[readonlyInput]="true" 
							[dateFormat]="dateFormat"
							monthNavigator="true" 
							yearNavigator="true"
							[yearRange]="yearRange"
							showButtonBar="true"
							appendTo="body" 
							[dataType]="'date'">
					</p-calendar>
				</div>
			</div>
			<div class="ui-grid-row">
				<div class="ui-grid-col-3"></div>
				<div class="ui-grid-col-9">
					<div *ngIf="dataSedintaDeLaFormControl.invalid && (dataSedintaDeLaFormControl.dirty || dataSedintaDeLaFormControl.touched)" class="ui-message ui-widget ui-corner-all ui-message-error">
						<span class="ui-message-icon pi pi-times"></span>
						<span *ngIf="dataSedintaDeLaFormControl.errors['required']" class="ui-message-text">{{'MESSAGES.VALIDATOR_MANDATORY_FIELD' | translate}}</span>
					</div>
				</div>
			</div>

			<div class="ui-grid-row">
				<div class="ui-grid-col-3">
					{{'LABELS.RAPORT_CENTRALIZATOR_PREZENTA_PERIOADA_FILTER_PANA_LA_DATA' | translate}}*:
				</div>
				<div class="ui-grid-col-9">
					<p-calendar formControlName="dataSedintaPanaLa"
							showIcon="true" 
							[readonlyInput]="true" 
							[dateFormat]="dateFormat"
							monthNavigator="true" 
							yearNavigator="true"
							[yearRange]="yearRange"
							showButtonBar="true"
							appendTo="body" 
							[dataType]="'date'">
					</p-calendar>
				</div>
			</div>
			<div class="ui-grid-row">
				<div class="ui-grid-col-3"></div>
				<div class="ui-grid-col-9">
					<div *ngIf="dataSedintaPanaLaFormControl.invalid && (dataSedintaPanaLaFormControl.dirty || dataSedintaPanaLaFormControl.touched)" class="ui-message ui-widget ui-corner-all ui-message-error">
						<span class="ui-message-icon pi pi-times"></span>
						<span *ngIf="dataSedintaPanaLaFormControl.errors['required']" class="ui-message-text">{{'MESSAGES.VALIDATOR_MANDATORY_FIELD' | translate}}</span>
					</div>
				</div>
			</div>

			<div class="ui-grid-row">
				<div class="ui-grid-col-3">
					{{'LABELS.RAPORT_CENTRALIZATOR_PREZENTA_PERIOADA_FILTERE_COMISIE' | translate}}:
				</div>
				<div class="ui-grid-col-9">
					<p-dropdown 
						[options]="comisieSelectItems" 
						[placeholder]="'LABELS.ALL' | translate"
						showClear="true"
						[style]="{'width':'100%'}" 
						filter="true"
						formControlName="comisie">
					</p-dropdown>
				</div>
			</div>

			<div class="ui-grid-row">
				<div class="ui-grid-col-3">
					{{'LABELS.RAPORT_CENTRALIZATOR_PREZENTA_PERIOADA_FILTER_BANCA' | translate}}:
				</div>
				<div class="ui-grid-col-9">
					<p-dropdown 
						[options]="bancaSelectItems" 
						[placeholder]="'LABELS.ALL' | translate"
						showClear="true"
						[style]="{'width':'100%'}"
						filter="true" 
						formControlName="banca">
					</p-dropdown>
				</div>
            </div>
            
            <div class="ui-grid-row">
				<div class="ui-grid-col-3">
					{{'LABELS.RAPORT_CENTRALIZATOR_PREZENTA_PERIOADA_FILTER_LEVEL' | translate}}:
				</div>
				<div class="ui-grid-col-9">
					<p-dropdown 
						[options]="levelSelectItems" 
						[placeholder]="'LABELS.ALL' | translate"
						showClear="true"
						[style]="{'width':'100%'}"
						filter="true" 
						formControlName="level">
					</p-dropdown>
				</div>
			</div>
		</div>
	</form>
	<p-footer>
		<p-button [label]="'LABELS.REPORT_VIEW' | translate" (onClick)="onView()"></p-button>
		<p-button [label]="'LABELS.EXPORT_CSV' | translate" (onClick)="exportCSV()"></p-button>
	</p-footer>
</p-panel>

<p-table *ngIf="reportVisible"
		[value]="report.rows"  
		[columns]="columns"
		[selectionMode]="'multiple'"
		[responsive]="true"
		[resizableColumns]="true"
		[loading]="loading"
		[style]="{'margin-top':'5px'}"
		[scrollable]="true" 
		[scrollHeight]="scrollHeight">

	<ng-template pTemplate="colgroup">
		<colgroup>
			<col style="width: 50px">
			<col style="width: 30%">
			<col style="width: 20%">
			<col style="width: 10%">
			<col style="width: 10%">
			<col style="width: 10%">
			<col style="width: 10%">
			<col style="width: 10%">
			<col style="width: 10%">
		</colgroup>
	</ng-template>

	<ng-template pTemplate="header">
			<tr>
                <th>{{"LABELS.NO_CRT" | translate}}</th>
				<th pResizableColumn>{{"LABELS.RAPORT_CENTRALIZATOR_PREZENTA_PERIOADA_BANCA" | translate}}</th>
				<th pResizableColumn>{{"LABELS.RAPORT_CENTRALIZATOR_PREZENTA_PERIOADA_COMISIE" | translate}}</th>
				<th pResizableColumn>{{"LABELS.RAPORT_CENTRALIZATOR_PREZENTA_PERIOADA_PARTICIPARI_LEVEL_0" | translate}}</th>
				<th pResizableColumn>{{"LABELS.RAPORT_CENTRALIZATOR_PREZENTA_PERIOADA_PARTICIPARI_LEVEL_1" | translate}}</th>
				<th pResizableColumn>{{"LABELS.RAPORT_CENTRALIZATOR_PREZENTA_PERIOADA_PARTICIPARI_LEVEL_2" | translate}}</th>
				<th pResizableColumn>{{"LABELS.RAPORT_CENTRALIZATOR_PREZENTA_PERIOADA_PARTICIPARI_LEVEL_3" | translate}}</th>
				<th pResizableColumn>{{"LABELS.RAPORT_CENTRALIZATOR_PREZENTA_PERIOADA_PARTICIPARI_LEVEL_3_PLUS" | translate}}</th>
				<th pResizableColumn>{{"LABELS.RAPORT_CENTRALIZATOR_PREZENTA_PERIOADA_PARTICIPARI_IN_AFARA_NOM" | translate}}</th>
			</tr>
	</ng-template>
	<ng-template pTemplate="body" let-row let-index="rowIndex">
			<tr [pSelectableRow]="row">		
				<td>{{index + 1}}</td>
				<td *ngIf="row.comisie == null"> <b>{{"LABELS.RAPORT_CENTRALIZATOR_PREZENTA_PERIOADA_TOTAL_BANCA" | translate}}{{row.banca}}</b></td>	
				<td *ngIf="row.comisie!= null">{{row.banca}}</td>
				<td>{{row.comisie}}</td>	
				<td *ngIf="row.comisie == null"> <b>{{row.participariLevel0}}</b></td>	
				<td *ngIf="row.comisie != null">{{row.participariLevel0}}</td>
				<td *ngIf="row.comisie == null"> <b>{{row.participariLevel1}}</b></td>	
				<td *ngIf="row.comisie != null">{{row.participariLevel1}}</td>
				<td *ngIf="row.comisie == null"> <b>{{row.participariLevel2}}</b></td>	
				<td *ngIf="row.comisie != null">{{row.participariLevel2}}</td>
				<td *ngIf="row.comisie == null"> <b>{{row.participariLevel3}}</b></td>	
				<td *ngIf="row.comisie != null">{{row.participariLevel3}}</td>
				<td *ngIf="row.comisie == null"> <b>{{row.participariLevel3Plus}}</b></td>	
				<td *ngIf="row.comisie != null">{{row.participariLevel3Plus}}</td>

				<td *ngIf="row.comisie == null"> <b>{{row.participariInAfaraNom}}</b></td>	
				<td *ngIf="row.comisie != null">{{row.participariInAfaraNom}}</td>
			</tr>
    </ng-template>
    <ng-template pTemplate="footer" *ngIf="footerVisible">
        <tr>
            <td colspan="3"> <b>{{"LABELS.RAPORT_CENTRALIZATOR_PREZENTA_PERIOADA_TOTAL_GENERAL" | translate}}</b></td>
            <td><b>{{report.totalParticipariLevel0}}</b></td>			
            <td><b>{{report.totalParticipariLevel1}}</b></td>			
            <td><b>{{report.totalParticipariLevel2}}</b></td>			
            <td><b>{{report.totalParticipariLevel3}}</b></td>			
            <td><b>{{report.totalParticipariLevel3Plus}}</b></td>			
            <td><b>{{report.totalParticipariInAfaraNom}}</b></td>			
        </tr>
    </ng-template>
	<ng-template pTemplate="emptymessage" let-columns>
        <tr>
            <td [attr.colspan]="9">
                {{"LABELS.NO_RECORDS_FOUND" | translate}}
            </td>
        </tr>
    </ng-template>
</p-table>